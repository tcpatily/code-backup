function updateBestSellingPackagesUI(packages) {
    setTimeout(function () {
        packages.forEach(function (pkg) {
            var $overlay = $('#' + pkg.packageId);
            if ($overlay.length === 0) {
                console.log(`No overlay found with ID "${pkg.packageId}"`);
                return;
            }
			
			var $nameElement = $overlay.find('h3');
            if ($nameElement.length) {
                $nameElement.text(pkg.pkgName || "Unnamed Package");
            }
			
            // Update price
            var $priceElement = $overlay.find('.text');
            if ($priceElement.length) {
                $priceElement.text(`Starting From @ â‚¹${Number(pkg.startingPrice).toLocaleString('en-IN')}`);
            }

            // Update rating
            var $ratingElement = $overlay.find('.subtext');
            if ($ratingElement.length) {
                var stars = 'ðŸŒŸ';
                var rating = pkg.rating ? pkg.rating.toFixed(1) : '0.0';
                var customers = pkg.noOfCustomers >= 1000
                        ? `${(pkg.noOfCustomers / 1000).toFixed(1)}K`
                        : pkg.noOfCustomers || 0;

                $ratingElement.text(`${stars} ${rating} (${customers})`);
            }
        });
    }, 4000);
}

createApp({
    setup() {
        console.log("offers.js");

        const categorizedOffers = ref();
        const {baseImageURL} = getBaseConfig();
        const pageType = document.querySelector(".hero_section")?.dataset?.pageType;
        const onBehalfValue = ref(localStorage.getItem('onBehalf'));
        const flagInt = ref(false);
        const flagDom = ref(false);

        async function getCategorizedOffer() {
            try {
                const response = await doAxios({
                    method: "get",
                    url: `/tcHolidayRS/Offers/getCategorizedOffers`,
                });
                categorizedOffers.value = response.data;
                for (var i = 0; i < categorizedOffers.value.internationalOffers.length; i++) {
                    if (categorizedOffers.value.internationalOffers[i]) {
                        if ((categorizedOffers.value.internationalOffers[i].internalOffer == 'Y' && onBehalfValue == 'true') || categorizedOffers.value.internationalOffers[i].internalOffer == 'N')
                        {
                            flagInt.value = true;
                            console.log("flagInt.value: ", flagInt.value);
                        }
                    }
                }
                for (var i = 0; i < categorizedOffers.value.domesticOffers.length; i++) {
                    if (categorizedOffers.value.domesticOffers[i]) {
                        if ((categorizedOffers.value.domesticOffers[i].internalOffer == 'Y' && onBehalfValue == 'true') || categorizedOffers.value.domesticOffers[i].internalOffer == 'N')
                        {
                            flagDom.value = true;
                            console.log("flagDom.value: ", flagDom.value);
                        }
                    }
                }

                console.log("categorizedOffers.value:", categorizedOffers.value);
            } catch (err) {
                console.error("Suggestion fetch failed:", err);
            }
        }
        const formatDate = (dateString) => {
            // Remove the [UTC] part if present
            const cleanedString = dateString.replace(/\[UTC\]$/, '');
            const date = new Date(cleanedString);

            // Format as "Month Day, Year, HH:MM:SS" in IST (Asia/Kolkata timezone)
            return date.toLocaleString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                timeZone: 'Asia/Kolkata'
            });
        };



        onMounted(() => {
            console.log("offers.js - onMounted");
            getCategorizedOffer();
        });

        return {
            categorizedOffers,
            baseImageURL,
            pageType,
            formatDate,
            onBehalfValue,
            flagDom,
            flagInt,
        };
    },
}).mount(".offers_section");

createApp({
    setup() {
        const bestSellingPackages = ref([]);



        async function getBestSellingPackages() {
            try {
                // Grab raw package IDs from visible DOM
                const indiaPackagesRaw = document.querySelectorAll('#holidaysLPBestSellingPackagesIndia .package-id');
                const internationalPackagesRaw = document.querySelectorAll('#holidaysLPBestSellingPackagesInternational .package-id');

                // Collect all IDs
                const packageIds = new Set();
                indiaPackagesRaw.forEach(el => packageIds.add(el.textContent.trim()));
                internationalPackagesRaw.forEach(el => packageIds.add(el.textContent.trim()));

                const packageIdArray = Array.from(packageIds).filter(id => id !== "");
                if (packageIdArray.length === 0) {
                    console.info("No package IDs found in DOM.");
                    return;
                }
                const response = await doAxios({
                    method: "post",
                    url: '/tcHolidayRS/bestSelling/bestSellingPackages',
                    data: {packageIds: packageIdArray.join(",")},
                    headers: {
                        "Content-Type": "application/json"
                    }
                });

                bestSellingPackages.value = response.data;
                console.log("API data fetched:", bestSellingPackages.value);
                // Safely extract the array from the object
                var pkgArr = Array.isArray(bestSellingPackages.value.pkgs)
                        ? bestSellingPackages.value.pkgs
                        : [];

                console.log(pkgArr);

                updateBestSellingPackagesUI(pkgArr);
            } catch (err) {
                console.error(" Error fetching best selling packages:", err);
            }
        }

        onMounted(() => {
if (document.readyState === 'complete') {
        getBestSellingPackages();
    } else {
        window.addEventListener('load', getBestSellingPackages);
    }        });

        return {
            bestSellingPackages
        };
    }
}).mount(".best_selling");

createApp({
    setup() {
        const travelblogsData = ref([]);

        async function getTravelblogs() {
            try {
                const response = await fetch(
                        `https://www.thomascook.in/blog/wp-json/wp/v2/posts?_embed&author=3598&per_page=10`
                        );
                if (!response.ok)
                    throw new Error(`HTTP error! ${response.status}`);
                const data = await response.json();
                travelblogsData.value = data;
            } catch (err) {
                console.error("Suggestion fetch failed:", err);
            }
        }

        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        onMounted(() => {
            getTravelblogs();
        });

        return {
            travelblogsData,
            formatDate,
        };
    },
}).mount(".travelBlogs");


